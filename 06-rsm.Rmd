# The radiological search model (RSM) {#rsm}


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(exactci)
```


## How much finished {#rsm-how-much-finished}
60%
Switch to $\mu$, $\lambda$ and $\nu$ and do away with prime parameter?



## Introduction {#rsm-intro}

All models of ROC data *that do not incorporate search* involve two fundamental parameters (i.e, not including binning-related threshold parameters). For example, the unequal variance binormal model requires the $a,b$ parameters. Alternative ROC models (e.g., CBM and PROPROC) also require two fundamental parameters.

Two fundamental parameters of ROC models are needed (1) to accommodate the average visibility of lesions in the dataset (e.g., the $a$ parameter) and (ii) the fact that the observed diseased case distribution is usually wider than that of the non-diseased cases (e.g., the $b <1$ parameter). If one assumes same widths for both distributions, so in effect $b=1$ is no longer a free parameter, and one allows a varying number of latent marks on all cases, then it becomes possible that the distribution of the highest rating on diseased cases will have greater width than that on non-diseased cases simply due to the fact that latent NLs on diseased cases will have lower z-samples than latent LLs on diseased cases. So the basic idea is to have a visibility parameter, a parameter describing the distribution of the number of latent NLs per case and a parameter describing the distribution of the number of latent LLs per case, i.e., a three-parameter model. Accordingly the RSM contains three fundamental parameters: $\mu$, $\lambda$ and $\nu$. 


## The radiological search model {#rsm-details}
The radiological search model (RSM) for the free-response paradigm is a statistical parameterization of the Nodine-Kundel model. It consists of:

* A *search stage* in which suspicious regions, i.e., the latent marks, are identified (via peripheral vision). The total number of latent marks on a case is $\geq 0$; some cases may have zero latent marks, a fact that will turn out to have important consequences for the shapes of all RSM predicted operating characteristics.

* A *decision stage* during which each latent mark is closely examined (via foveal scanning), relevant features are extracted and analyzed and the observer calculates a decision variable or z-sample for each latent mark.

* If the z-sample exceeds a pre-selected minimum reporting threshold, denoted $\zeta_1$ the location is marked, i.e., the latent mark becomes an actual mark. 

* Latent marks can be either latent NLs (corresponding to non-diseased regions) or latent LLs (corresponding to diseased regions). The number of latent NLs on a case is denoted $l_1$. The number of latent LLs on a diseased case is denoted $l_2$. Latent NLs can occur on non-diseased or diseased cases, but latent LLs can only occur on diseased cases. We initially assume that every diseased case has $L$ actual lesions. Later this will be extended to arbitrary number of lesions per diseased case. ^[In this chapter distributional assumptions are made for the numbers of latent NLs and LLs and the associated z-samples. Since the RSM is a parametric model one does not need the four subscript notation needed to account for case and location dependence, as necessary in the empirical description in Chapter \@ref(empirical). This allows for a simpler notation, as the reader may have noticed, unencumbered by the 4 subscripts in Table \@ref(empirical-notation).]

## RSM assumptions {#rsm-assumptions}

**Assumption 1:** The number of latent NLs, $l_1 \geq 0$, is sampled from the Poisson distribution $\text{Poi}()$ with mean $\lambda$:

\begin{equation} 
l_1 \sim \text{Poi}\left ( \lambda \right ) 
(\#eq:rsm-poisson-sampling)
\end{equation}


The probability mass function (pmf) of the Poisson distribution is defined by:

\begin{equation} 
\text{pmf}_{Poi}\left ( l_1, \lambda \right ) = exp\left ( -\lambda \right ) \frac{{(\lambda)^{l_1}}}{l_1!}
(\#eq:rsm-poisson-pmf)
\end{equation}

**Assumption 2:** The number of latent LLs, $l_2$, where $0 \leq l_2 \leq L$ (since the number of latent LLs cannot exceed the number of lesions) is sampled from the binomial distribution $\text{Bin}()$ with success probability $\nu$ and trial size $L$: 


\begin{equation} 
l_2 \sim \text{Bin}\left ( L, \nu \right ) 
(\#eq:rsm-binomial-sampling)
\end{equation}

The probability mass function (pmf) of the binomial distribution is defined by:

\begin{equation} 
\text{pmf}_{Bin}\left ( l_2, L, \nu \right ) = \binom{L}{l_2} \left (\nu  \right )^{l_2} \left (1-\nu  \right )^{L-l_2}
(\#eq:rsm-binomial-pmf)
\end{equation}

> Collectively $\lambda$ and $\nu$ are termed the *search performance* parameters.

**Assumption 3:** Each latent mark is associated with a z-sample. That for a latent NL is denoted $z_{l_1}$ while that for a latent LL is denoted $z_{l_2}$. Latent NLs can occur on non-diseased and diseased cases while latent LLs can only occur on diseased cases.

**Assumption 4:** For latent NLs the z-samples are obtained by sampling $N \left ( 0, 1 \right )$:

\begin{equation} 
z_{l_1} \sim N \left ( 0, 1 \right )
(\#eq:rsm-sampling-l1)
\end{equation}

**Assumption 5:** For latent LLs the z-samples are obtained by sampling $N \left ( \mu, 1 \right )$:

\begin{equation} 
z_{l_2} \sim N \left ( \mu, 1 \right )
(\#eq:rsm-sampling-l2)
\end{equation}


The probability density function $\phi\left ( z | \mu \right )$ of the normal distribution $N \left ( \mu, 1 \right )$ is defined by:


\begin{equation} 
\phi\left ( z | \mu \right )=\frac{1}{\sqrt{2\pi}}\exp\left ( -\frac{(z-\mu)^2}{2} \right )
(\#eq:rsm-pdf-phi-mu)
\end{equation}

> The parameter $\mu$ is termed the *classification performance* parameter.


**Binning rule:** In an FROC study with R ratings, the observer adopts $R$ ordered cutoffs $\zeta_r$, where $\left ( r = 1, 2, ..., R \right )$. Defining  $\zeta_0 = -\infty$ and $\zeta_{R+1} = \infty$, then if $\zeta_r \leq z_{l_s} < \zeta_{r+1}$ the corresponding latent site is marked and rated in bin $r$, and if $z_{l_s} \leq \zeta_1$ the site is not marked. Note that $R$ is the number of FROC bins.

**Mark location:** The location of the mark is assumed to be at the exact center of the latent site that exceeded a cutoff and an infinitely precise proximity criterion is adopted. Consequently, there is no confusing a mark made because of a latent LL z-sample exceeding the cutoff with one made because of a latent NL z-sample exceeding the cutoff. Therefore, any mark made because of a latent NL z-sample that satisfies $\zeta_r \leq z_{l_1} < \zeta_{r+1}$ will be scored as a non-lesion localization (NL) and rated $r$. Likewise, any mark made because of a latent LL z-sample that satisfies $\zeta_r \leq z_{l_2} < \zeta_{r+1}$ will be scored as a lesion-localization (LL) and rated $r$. 

**Rating assigned to unmarked sites:** Unmarked LLs are assigned the zero rating: even lesions that were not found by the search stage, and therefore do not qualify as latent LLs, are assigned the zero rating. This is because they represent observable events. In contrast, unmarked latent NLs are unobservable events (unlike lesions there is no a-priori reader-independent list of non-lesion locations; in fact, what constitutes a NL is reader dependent).

By choosing $R$ large enough, the preceding discrete rating model is applicable to continuous z-samples.


## Physical interpretation of RSM parameters {#rsm-parameter-interpretations}
The parameters have the following meanings:

### The $\mu$ parameter {#rsm-mu-parameter}
The $\mu$ parameter is the lesion contrast-to-noise-ratio, or more accurately, the *perceptual signal to noise ratio pSNR* described in (print book) Chapter 12.5.2, between latent NLs and latent LLs. For clinical backgrounds pSNR is determined by the competition for the observer's foveal attention from other regions that could be mistaken for lesions.  

The $\mu$ parameter is similar to detectability index $d'$, which is the separation parameter of two unit normal distributions required to achieve the observed probability of correct choice (PC) in a two alternative forced choice task between cued NLs and cued LLs. Individually and for each reader one determines the locations of the latent marks using eye-tracking apparatus and then runs a 2AFC study as follows: pairs of images are shown, each with a cued location, one a latent NL and the other a latent LL, where all locations were recorded in prior eye-tracking sessions for the specific radiologist. The radiologist's task is to pick the image with the latent LL. The probability correct $\text{PC}$ in this task is related to the $d'$ parameter by:

\begin{equation} 
\mu = \sqrt{2} \Phi^{-1} \left ( \text{PC} \right )
(\#eq:rsm-mu-2afc)
\end{equation}

The radiologist on whom the eye-tracking measurements are performed and the one who performs the two alternative forced choice tasks must be the same, as two radiologists may not agree on latent NL marks. A complication in conducting such a study is that because of memory effects a lesion can only be shown once to each reader: clinical images are distinctive - once a radiologist has found a lesion in a clinical image, that event may become imprinted in long-term memory; one cannot repeatedly compare this lesion to other NLs in the 2AFC task as the radiologist will always pick the remembered lesion. This is a difficult study to conduct as I found out.


### The $\lambda$ parameter {#rsm-summary-lambda-parameter}

The $\lambda$ parameter determines the tendency of the observer to generate latent NLs. The mean number of latent NLs per case is an estimate of $\lambda$. ^[It can be measured via eye-tracking apparatus. This time it is only necessary to cluster the marks and classify each mark as a latent NL or latent LL according to the adopted acceptance radius. An eye-tracking based estimate would be the total number of latent NLs in the dataset divided by the total number of cases.]

Consider two observers, one with $\lambda = 1$ and the other with $\lambda = 2$. While one cannot predict the exact number of latent NLs on any specific case, one can predict the average number of latent NLs on a given case set. 

In the following examples the number of samples has been set to $K_1=100$ (the first argument to `rpois()`; the second argument is $\lambda$). 

#### Example 1

```{r rsm-code-snippet-poisson-samples1, echo=TRUE}
seed <- 1;set.seed(seed)
K1 <- 100
samples1 <- rpois(K1,1)
```


```{r, echo=FALSE}
cat("mean(samples1) = ", mean(samples1))
cat("samples1[1:10] = ", samples1[1:10])
```


For this observer, $\lambda = 1$, the first case generated zero latent NLs, the 2nd and 3rd cases generated one NL each, the third case generated 2 NLs, etc. 

#### Example 2

```{r rsm-code-snippet-poisson-samples2, echo=TRUE}
seed <- 1;set.seed(seed)
samples2 <- rpois(K1,2)
```


```{r, echo=FALSE}
cat("mean(samples2) = ", mean(samples2))
cat("samples2[1:10] = ", samples2[1:10])
```


For the second observer $\lambda = 2$, the first and second case generated one latent NL each, the third generated two, etc. The average number of latent NL marks per case for the first observer is 1.01 and that for the second one is 2.02.

### The $\nu$ parameter {#rsm-summary-nu-parameter}
The $\nu$ parameter determines the ability of the observer to find lesions. Assuming the same number of lesions per diseased case, the mean fraction of latent LLs per diseased case is an estimate of $\nu$. ^[It too can be measured via eye-tracking apparatus performed on a radiologist. An eye-tracking based estimate would be the total number of latent LLs in the dataset divided by the total number of lesions.] Consider two observers, one with  $\nu = 0.5$ and the other with $\nu = 0.9$. Again, while one cannot predict the precise number of latent LLs on any specific diseased case, or which specific lesions will be correctly localized, one can predict the average number of latent LLs per diseased case. 

The following code also uses $K_2 = 100$ samples, the number of diseased cases, each with one lesion. 

```{r rsm-code-snippet-binomial-example1, echo=TRUE}
K2 <- 100
L <- 1
nu1 <- 0.5;nu2 <- 0.9;
seed <- 1;set.seed(seed);samples1 <- rbinom(K2,L,nu1)
seed <- 1;set.seed(seed);samples2 <- rbinom(K2,L,nu2)

ret1 <- binom.exact(sum(samples1),K2*L)
ret2 <- binom.exact(sum(samples2),K2*L)
```


```{r, echo=FALSE}
cat ("K2 = ", K2,", nu 1st reader = ", 0.5,", nu 2nd reader = ", 0.9,"\n")
cat("mean, reader 1 = ", mean(samples1)/L, "\n")
cat("mean, reader 2 = ", mean(samples2)/L, "\n")
cat ("Rdr. 1: 95% CI = ", ret1$conf.int[1:2],"\n")
cat ("Rdr. 2: 95% CI = ", ret2$conf.int[1:2],"\n")
```

The result shows that for reader 1 the estimate of the binomial success rate parameter is 0.48 with 95% confidence interval (0.379, 0.582). For reader 2 the corresponding estimates are 0.94 and (0.874, 0.977). 

As a more complicated but clinically realistic example, consider a dataset with 100 cases in all where 97 have one lesion per case, two have two lesions per case and one has three lesions per case (these are typical lesion distributions observed in screening mammography). The code follows:


```{r rsm-code-snippet-binomial-example2, echo=TRUE}
K2 <- c(97,2,1);Lk <- c(1,2,3);nu1 <- 0.5;nu2 <- 0.9;
samples1 <- array(dim = c(sum(K2),length(K2)))
seed <- 1;set.seed(seed)
for (l in 1:length(K2)) {
  samples1[1:K2[l],l] <- rbinom(K2[l],Lk[l],nu1)
}

samples2 <- array(dim = c(sum(K2),length(K2)))
seed <- 1;set.seed(seed)
for (l in 1:length(K2)) {
  samples2[1:K2[l],l] <- rbinom(K2[l],Lk[l],nu2)
}

ret1 <- binom.exact(sum(samples1[!is.na(samples1)]),sum(K2*Lk))
ret2 <- binom.exact(sum(samples2[!is.na(samples2)]),sum(K2*Lk))
```

```{r, echo=FALSE}
cat("K2[1] =", K2[1],", K2[2] =", K2[2],", K2[3] =", K2[3], ", nu1 =", nu1, ", nu2 =", nu2)
cat("obsvd. mean, reader 1 = ", sum(samples1[!is.na(samples1)])/sum(K2*Lk))
cat("obsvd. mean, reader 2 = ", sum(samples2[!is.na(samples2)])/sum(K2*Lk))
cat ("Rdr. 1: 95% CI = ", ret1$conf.int[1:2])
cat ("Rdr. 2: 95% CI = ", ret2$conf.int[1:2])
```


For reader 1, the estimate of the binomial success probability is 0.490 with 95% confidence interval (0.391, 0.590); for reader 2 the corresponding estimates are 0.933 and (0.866, 0.973). 


## Model re-parameterization {#rsm-re-parameterization}
While the parameters $\mu$, $\lambda$ and $\nu$ are physically meaningful a little thought reveals that they cannot be varied independently of each other. Rather, $\mu$ is the *intrinsic* parameter whose value, together with two other intrinsic parameters $\lambda_i$ and $\nu_i$, determine $\lambda$ and $\nu$, respectively. The following is a convenient re-parameterization ^[The need for the first re-parameterization, involving $\nu$, was foreseen in the original search model papers [@chakraborty2006search; @chakraborty2006roc] but the need for the second re-parameterization (involving $\lambda$) was discovered more recently.]:


\begin{equation}
\left. 
\begin{aligned}
\nu =& 1 - exp\left ( - \mu \nu_i \right ) \\
\lambda =& \frac{\lambda_i}{\mu}
\end{aligned}
\right \}
(\#eq:rsm-transform)
\end{equation}


The inverse transformations are:


\begin{equation}
\left. 
\begin{aligned}
\nu_i =& - \frac{\ln \left ( 1-\nu \right )}{\mu}\\
\lambda_i =& \mu \lambda 
\end{aligned}
\right \}
(\#eq:rsm-inv-transform)
\end{equation}


The parameter limits are as follows: $0 \le \nu \le 1$, $\lambda \ge 0$, $\mu \ge 0$, $\lambda_i \ge 0$ and $\nu_i \ge 0$.  

Since it determines $\nu$, the $\nu_i$ parameter can be considered as the intrinsic (i.e., $\mu$-independent) ability to find lesions; specifically, it is the rate of increase of $\nu$  with $\mu$ at small $\mu$:


\begin{equation} 
\nu_i = \left (\frac{\partial \nu}{\partial \mu}  \right )_{\mu = 0}
(\#eq:rsm-nup-limit)
\end{equation}


According to Eqn. \@ref(eq:rsm-transform), as $\mu \rightarrow \infty$, $\nu \rightarrow 1$ and conversely, as $\mu \rightarrow 0$, $\nu \rightarrow 0$. The dependence of $\nu$ on $\mu$ is consistent with the fact that higher contrast lesions are easier to find. An observer without special expertise may find a high contrast lesion. Conversely, lower contrast lesions will be more difficult to find even by expert observers. 

The analogy to finding the sun in Chapter \@ref(froc-paradigm-solar-analogy) is instructive: objects with very high perceptual SNR are certain to be found.

According to Eqn. \@ref(eq:rsm-transform) the value of $\mu$ also determines $\lambda$: as $\mu \rightarrow \infty$, $\lambda \rightarrow 0$, and conversely, as $\mu \rightarrow 0$, $\lambda \rightarrow \infty$. Here too the sun analogy is instructive. Since the sun has very high contrast, there is no reason for the observer to search for other suspicious regions which have no possibility of resembling the sun. On the other hand, attempting to locate a faint star, possibly hidden by clouds, can generate latent NLs, because the expected small SNR from the faint real star could be comparable to that from a number of regions in the near background.


## Discussion / Summary {#rsm-discussion-summary}

This chapter has described a statistical parameterization of the Nodine-Kundel model. The 3-parameter model of search in the context in the medical imaging accommodates key aspects of the process: search, finding lesions and finding non-lesions. These are characterized by the two search parameters $\lambda$ and $\nu$.The ability to correctly rate a lesion higher than a NL is characterized by the third parameter of the model $\mu$. While the primed parameters have relatively simple physical meanings they depend on $\mu$. Consequently, it is necessary to introduce the intrinsic parameters $\lambda_i$ and $\nu_i$ which are independent of $\mu$. 


The next chapter explores the predictions of the radiological search model.


## References {#rsm-references}
1.	Chakraborty DP. Computer analysis of mammography phantom images (CAMPI): An application to the measurement of microcalcification image quality of directly acquired digital images. Medical Physics. 1997;24(8):1269-1277.
2.	Chakraborty DP, Eckert MP. Quantitative versus subjective evaluation of mammography accreditation phantom images. Medical Physics. 1995;22(2):133-143.
3.	Chakraborty DP, Yoon H-J, Mello-Thoms C. Application of threshold-bias independent analysis to eye-tracking and FROC data. Academic Radiology. 2012;In press.
4.	Chakraborty DP. ROC Curves predicted by a model of visual search. Phys Med Biol. 2006;51:3463–3482.
5.	Chakraborty DP. A search model and figure of merit for observer data acquired according to the free-response paradigm. Phys Med Biol. 2006;51:3449–3462.

